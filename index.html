<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VeriPura Phase 2 - Complete Export Compliance Platform</title>
    
    <!-- External Dependencies -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    
    <style>
        /* VeriPura Phase 2 CSS */
        :root {
            --veripura-navy: #1e3a8a;
            --veripura-blue: #3b82f6;
            --veripura-light-blue: #60a5fa;
            --primary-blue: #1e40af;
            --success-blue: #0f766e;
            --warning-yellow: #d97706;
            --danger-red: #dc2626;
            --info-blue: #0284c7;
            --demo-orange: #ea580c;
            --neutral-gray: #6b7280;
            --cooperative-green: #059669;
            --border-radius: 0.375rem;
            --box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            --box-shadow-hover: 0 4px 12px rgba(0,0,0,0.15);
            --transition-default: all 0.2s ease;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f8fafc;
            margin: 0;
            padding: 0;
        }

        .hide { display: none !important; }
        .text-primary { color: var(--primary-blue) !important; }
        .bg-primary { background-color: var(--primary-blue) !important; }
        
        .btn-primary {
            background-color: var(--veripura-navy);
            border-color: var(--veripura-navy);
            color: white;
        }
        .btn-primary:hover {
            background-color: var(--primary-blue);
            border-color: var(--primary-blue);
        }

        .demo-banner {
            background: linear-gradient(90deg, var(--demo-orange), #f97316);
            color: white;
            text-align: center;
            padding: 8px;
            font-weight: 600;
            font-size: 14px;
            position: sticky;
            top: 0;
            z-index: 1000;
            box-shadow: var(--box-shadow);
        }

        .veripura-logo {
            width: 32px;
            height: 32px;
            margin-right: 10px;
            background: linear-gradient(135deg, var(--veripura-blue), var(--veripura-navy));
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 18px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .veripura-logo:hover {
            transform: scale(1.1);
            box-shadow: 0 2px 8px rgba(30, 58, 138, 0.3);
        }

        .login-container {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, var(--veripura-light-blue) 0%, var(--veripura-navy) 100%);
        }

        .login-card {
            background: white;
            border-radius: 1rem;
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
            padding: 2rem;
            width: 100%;
            max-width: 400px;
        }

        .login-card .veripura-logo {
            width: 60px;
            height: 60px;
            font-size: 28px;
        }

        .login-card h1 {
            color: var(--veripura-navy);
        }

        .navbar-brand {
            display: flex;
            align-items: center;
            color: var(--veripura-navy) !important;
            font-weight: bold;
        }

        .alert-badge {
            position: relative;
            display: inline-block;
        }

        .alert-count {
            position: absolute;
            top: -8px;
            right: -8px;
            background-color: var(--danger-red);
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            font-size: 0.7rem;
            display: flex;
            align-items: center;
            justify-content: center;
            min-width: 20px;
        }

        .status-badge {
            font-size: 0.7rem;
            font-weight: 600;
            padding: 0.2rem 0.4rem;
            border-radius: var(--border-radius);
        }

        .status-overdue { background-color: #fecaca; color: #991b1b; }
        .status-due-soon { background-color: #fed7aa; color: #9a3412; }
        .status-on-track { background-color: #bfdbfe; color: #1e40af; }
        .status-complete { background-color: #e0f2fe; color: #0f766e; }
        .status-pending { background-color: #dbeafe; color: #1e40af; }
        .status-missing { background-color: #fecaca; color: #991b1b; }
        .status-expiring { background-color: #fed7aa; color: #9a3412; }
        .status-valid { background-color: #dcfce7; color: #166534; }
        .status-expired { background-color: #fecaca; color: #991b1b; }
        .status-draft { background-color: #e5e7eb; color: #374151; }
        .status-sent { background-color: #bfdbfe; color: #1e40af; }
        .status-accepted { background-color: #dcfce7; color: #166534; }
        .status-rejected { background-color: #fecaca; color: #991b1b; }
        .status-negotiating { background-color: #fed7aa; color: #9a3412; }
        .status-active { background-color: #dcfce7; color: #166534; }
        .status-approved { background-color: #dcfce7; color: #166534; }

        .company-badge {
            font-size: 0.6rem;
            font-weight: 600;
            padding: 0.15rem 0.3rem;
            border-radius: var(--border-radius);
            text-transform: uppercase;
        }

        .company-importer { background-color: #dbeafe; color: #1e40af; }
        .company-processor { background-color: #fef3c7; color: #92400e; }
        .company-cooperative { background-color: #d1fae5; color: #065f46; }

        .metric-card {
            background: white;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            transition: var(--transition-default);
            overflow: hidden;
            cursor: pointer;
        }

        .metric-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--box-shadow-hover);
        }

        .card-metric {
            text-align: center;
            padding: 1rem;
        }

        .card-metric h3 {
            font-size: 1.75rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
            line-height: 1.2;
        }

        .card-metric p {
            font-size: 0.9rem;
            margin-bottom: 0.25rem;
            font-weight: 500;
        }

        .card-metric small {
            font-size: 0.75rem;
            opacity: 0.8;
        }

        .dashboard-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 1rem;
            gap: 1rem;
        }

        .dashboard-title {
            flex: 1;
        }

        .dashboard-title h2 {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 0.5rem;
        }

        .dashboard-title .text-muted {
            margin-bottom: 0;
        }

        .dashboard-actions {
            flex-shrink: 0;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .content-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 1rem;
        }

        .section-card {
            background: white;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            overflow: hidden;
        }

        .section-card-header {
            padding: 1rem;
            background-color: #f9fafb;
            border-bottom: 1px solid #e5e7eb;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .section-card-body {
            padding: 1rem;
        }

        .data-table {
            width: 100%;
            font-size: 0.875rem;
        }

        .data-table th {
            padding: 0.75rem 0.5rem;
            font-weight: 600;
            font-size: 0.8rem;
            text-align: left;
            border-bottom: 2px solid #e5e7eb;
            background-color: #f9fafb;
        }

        .data-table td {
            padding: 0.75rem 0.5rem;
            border-bottom: 1px solid #f3f4f6;
            vertical-align: middle;
        }

        .data-table tr:hover {
            background-color: #f9fafb;
        }

        /* VERI Token Widget Styles */
        .veri-token-widget {
            background: linear-gradient(135deg, #10b981, #059669);
            border-radius: var(--border-radius);
            padding: 0.75rem 1rem;
            color: white;
            box-shadow: var(--box-shadow);
            transition: var(--transition-default);
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            min-width: 150px;
        }

        .veri-token-widget:hover {
            transform: translateY(-1px);
            box-shadow: var(--box-shadow-hover);
            background: linear-gradient(135deg, #059669, #047857);
        }

        .veri-token-icon {
            width: 28px;
            height: 28px;
            background: #10b981;
            border: 2px solid #065f46;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.9rem;
            color: #fbbf24;
            font-weight: bold;
        }

        .veri-token-info {
            flex: 1;
        }

        .veri-token-balance {
            font-size: 1rem;
            font-weight: bold;
            margin: 0;
            line-height: 1.2;
        }

        .veri-token-label {
            font-size: 0.75rem;
            opacity: 0.9;
            margin: 0;
            line-height: 1;
        }

        /* Opportunities Section Styles */
        .opportunities-card {
            background: white;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            overflow: hidden;
        }

        .opportunities-header {
            padding: 1rem;
            background: linear-gradient(135deg, #f0f9ff, #e0f2fe);
            border-bottom: 1px solid #e5e7eb;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .opportunities-filters {
            display: flex;
            gap: 0.5rem;
        }

        .filter-btn {
            background: white;
            border: 1px solid #d1d5db;
            padding: 0.25rem 0.5rem;
            border-radius: var(--border-radius);
            font-size: 0.75rem;
            cursor: pointer;
            transition: var(--transition-default);
        }

        .filter-btn.active {
            background: var(--primary-blue);
            color: white;
            border-color: var(--primary-blue);
        }

        .opportunity-item {
            padding: 1rem;
            border-bottom: 1px solid #f3f4f6;
            transition: var(--transition-default);
            cursor: pointer;
        }

        .opportunity-item:hover {
            background-color: #f9fafb;
        }

        .opportunity-item:last-child {
            border-bottom: none;
        }

        .opportunity-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 0.5rem;
        }

        .opportunity-title {
            font-weight: 600;
            color: var(--veripura-navy);
            margin-bottom: 0.25rem;
        }

        .opportunity-description {
            font-size: 0.875rem;
            color: var(--neutral-gray);
            margin-bottom: 0.5rem;
        }

        .opportunity-meta {
            display: flex;
            gap: 0.5rem;
            align-items: center;
            flex-wrap: wrap;
        }

        .difficulty-badge {
            font-size: 0.7rem;
            padding: 0.15rem 0.4rem;
            border-radius: var(--border-radius);
            font-weight: 600;
        }

        .difficulty-easy { background-color: #dcfce7; color: #166534; }
        .difficulty-medium { background-color: #fed7aa; color: #9a3412; }
        .difficulty-hard { background-color: #fecaca; color: #991b1b; }

        .token-reward {
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
            padding: 0.15rem 0.4rem;
            border-radius: var(--border-radius);
            font-size: 0.7rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 0.25rem;
        }

        .deadline-badge {
            background-color: #e0f2fe;
            color: #0c4a6e;
            padding: 0.15rem 0.4rem;
            border-radius: var(--border-radius);
            font-size: 0.7rem;
            font-weight: 600;
        }

        .opportunity-actions {
            margin-top: 0.75rem;
            display: flex;
            gap: 0.5rem;
        }

        .complete-task-btn {
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: var(--border-radius);
            font-size: 0.875rem;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition-default);
        }

        .complete-task-btn:hover {
            background: linear-gradient(135deg, #059669, #047857);
            transform: translateY(-1px);
        }

        .complete-task-btn:disabled {
            background: #9ca3af;
            cursor: not-allowed;
            transform: none;
        }

        .task-completed {
            background-color: #f0f9ff;
            border-left: 4px solid #10b981;
        }

        .task-completed .opportunity-title {
            text-decoration: line-through;
            opacity: 0.7;
        }

        @media (max-width: 768px) {
            .metrics-grid { grid-template-columns: 1fr; }
            .content-grid { grid-template-columns: 1fr; }
            .dashboard-header { flex-direction: column; gap: 1rem; }
            .dashboard-actions { width: 100%; }
            .opportunity-header { flex-direction: column; gap: 0.5rem; }
            .opportunities-filters { flex-wrap: wrap; }
        }
    </style>
</head>
<body>
    <!-- Demo Environment Banner -->
    <div class="demo-banner">
        <i class="fas fa-shield-alt"></i> 
        <strong>VERIPURA PHASE 2 - COMPLETE EXPORT COMPLIANCE PLATFORM</strong> - Full PO creation system with 7-document framework and RBAC integration.
    </div>

    <!-- Login Screen -->
    <div id="loginScreen" class="login-container">
        <div class="login-card">
            <div class="text-center mb-4">
                <div class="veripura-logo mx-auto mb-3">✓</div>
                <h1 class="h3 mb-3">
                    <strong>VeriPura Phase 2</strong>
                </h1>
                <p class="text-muted">Export Compliance Management Platform</p>
                <div class="alert alert-success mt-3">
                    <i class="fas fa-check-circle"></i> <strong>COMPLETE SYSTEM:</strong> PO creation, 7 document templates, VERI token system, and full RBAC integration.
                </div>
            </div>
            
            <form id="loginForm">
                <div class="mb-3">
                    <label class="form-label">Participant Type</label>
                    <select class="form-select" id="companyTypeSelect" required>
                        <option value="">Select Participant Type...</option>
                        <option value="importer">Importer</option>
                        <option value="processor">Processor</option>
                        <option value="cooperative">Cooperative</option>
                    </select>
                </div>

                <div class="mb-3">
                    <label class="form-label">Company/Organization</label>
                    <select class="form-select" id="companySelect" required>
                        <option value="">Select Organization...</option>
                    </select>
                </div>
                
                <div class="mb-3">
                    <label class="form-label">Role</label>
                    <select class="form-select" id="roleSelect" required>
                        <option value="">Select Role...</option>
                    </select>
                </div>
                
                <button type="submit" class="btn btn-primary w-100">
                    <i class="fas fa-sign-in-alt"></i> Enter VeriPura Platform
                </button>
            </form>
            
            <div class="text-center mt-3">
                <small class="text-muted">Try different roles to explore document access permissions and VERI token balances</small>
            </div>
        </div>
    </div>

    <!-- Main Application -->
    <div id="mainApp" class="hide">
        <!-- Navigation -->
        <nav class="navbar navbar-expand-lg navbar-light bg-white shadow-sm">
            <div class="container-fluid">
                <a class="navbar-brand" href="#">
                    <div class="veripura-logo">✓</div>
                    <strong>VeriPura Phase 2</strong>
                </a>
                
                <div class="navbar-nav ms-auto">
                    <!-- Notifications -->
                    <div class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle alert-badge" href="#" data-bs-toggle="dropdown">
                            <i class="fas fa-bell"></i>
                            <span class="alert-count" id="alertCount">3</span>
                        </a>
                        <div class="dropdown-menu dropdown-menu-end" id="alertDropdown">
                            <div class="dropdown-item-text">
                                <div class="d-flex align-items-center">
                                    <i class="fas fa-file-alt text-info me-2"></i>
                                    <div>
                                        <strong>New Document Required</strong><br>
                                        <small class="text-muted">Certificate of Origin needed</small>
                                    </div>
                                </div>
                            </div>
                            <div class="dropdown-divider"></div>
                            <div class="dropdown-item-text">
                                <div class="d-flex align-items-center">
                                    <i class="fas fa-exclamation-triangle text-danger me-2"></i>
                                    <div>
                                        <strong>Document Expiring</strong><br>
                                        <small class="text-muted">EORI Certificate expires soon</small>
                                    </div>
                                </div>
                            </div>
                            <div class="dropdown-divider"></div>
                            <div class="dropdown-item-text">
                                <div class="d-flex align-items-center">
                                    <i class="fas fa-clock text-warning me-2"></i>
                                    <div>
                                        <strong>Document Review Due</strong><br>
                                        <small class="text-muted">TRACES Registration</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- User Menu -->
                    <div class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" data-bs-toggle="dropdown">
                            <i class="fas fa-user-circle"></i>
                            <span id="currentUser">Demo User</span>
                        </a>
                        <div class="dropdown-menu dropdown-menu-end">
                            <div class="dropdown-item-text">
                                <div class="text-muted small">Current Permissions:</div>
                                <div id="userPermissions" class="small">Loading...</div>
                            </div>
                            <div class="dropdown-divider"></div>
                            <a class="dropdown-item" href="#" onclick="VeriPura.auth.switchRole()">
                                <i class="fas fa-exchange-alt"></i> Switch Role
                            </a>
                            <a class="dropdown-item" href="#" onclick="VeriPura.auth.logout()">
                                <i class="fas fa-sign-out-alt"></i> Logout
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </nav>

        <!-- Dashboard Container -->
        <div class="container-fluid mt-4">
            <div id="dashboardContainer">
                <!-- Dashboard content will be loaded here -->
            </div>
        </div>
    </div>

    <!-- Notification Toast -->
    <div id="notificationToast" class="notification-toast" style="position: fixed; top: 80px; right: 20px; background: white; border: 1px solid #e5e7eb; border-radius: 0.375rem; box-shadow: 0 4px 12px rgba(0,0,0,0.15); padding: 1rem; min-width: 300px; z-index: 1050; transform: translateX(100%); transition: transform 0.3s ease;">
        <div class="d-flex align-items-start">
            <div class="flex-grow-1">
                <div class="fw-bold" id="toastTitle">Notification</div>
                <div class="small" id="toastMessage">Message content</div>
            </div>
            <button type="button" class="btn-close btn-close-sm" onclick="VeriPura.notifications.hide()"></button>
        </div>
    </div>

    <!-- External Dependencies -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
        // VeriPura Phase 2 - Complete Export Compliance Platform with VERI Token System
        
        // Complete Data Structure
        window.VeriPuraData = {
            // VERI Token System - Phase 2 Implementation
            veriTokens: {
                'eu-gourmet': {
                    compliance: { balance: 2450, earned: 2450, spent: 0, lastActivity: '2025-08-16' },
                    purchase: { balance: 1875, earned: 1875, spent: 0, lastActivity: '2025-08-15' },
                    quality: { balance: 1320, earned: 1320, spent: 0, lastActivity: '2025-08-14' },
                    operations: { balance: 3200, earned: 3200, spent: 0, lastActivity: '2025-08-16' }
                },
                'thai-chili-sauce': {
                    export: { balance: 1680, earned: 1680, spent: 0, lastActivity: '2025-08-15' },
                    production: { balance: 890, earned: 890, spent: 0, lastActivity: '2025-08-13' },
                    qa: { balance: 1240, earned: 1240, spent: 0, lastActivity: '2025-08-14' },
                    compliance: { balance: 2100, earned: 2100, spent: 0, lastActivity: '2025-08-16' }
                },
                'thai-curry-paste': {
                    export: { balance: 1450, earned: 1450, spent: 0, lastActivity: '2025-08-12' },
                    production: { balance: 720, earned: 720, spent: 0, lastActivity: '2025-08-11' },
                    qa: { balance: 980, earned: 980, spent: 0, lastActivity: '2025-08-13' },
                    compliance: { balance: 1850, earned: 1850, spent: 0, lastActivity: '2025-08-14' }
                },
                'thai-coconut-milk': {
                    export: { balance: 1290, earned: 1290, spent: 0, lastActivity: '2025-08-10' },
                    production: { balance: 650, earned: 650, spent: 0, lastActivity: '2025-08-09' },
                    qa: { balance: 870, earned: 870, spent: 0, lastActivity: '2025-08-11' },
                    compliance: { balance: 1620, earned: 1620, spent: 0, lastActivity: '2025-08-12' }
                },
                'northern-herbs-organic': {
                    farming: { balance: 780, earned: 780, spent: 0, lastActivity: '2025-08-14' },
                    supply: { balance: 560, earned: 560, spent: 0, lastActivity: '2025-08-13' },
                    quality: { balance: 690, earned: 690, spent: 0, lastActivity: '2025-08-15' }
                },
                'northern-herbs-conventional': {
                    farming: { balance: 520, earned: 520, spent: 0, lastActivity: '2025-08-12' },
                    supply: { balance: 380, earned: 380, spent: 0, lastActivity: '2025-08-11' },
                    quality: { balance: 450, earned: 450, spent: 0, lastActivity: '2025-08-13' }
                },
                'central-chili-organic': {
                    farming: { balance: 890, earned: 890, spent: 0, lastActivity: '2025-08-15' },
                    supply: { balance: 670, earned: 670, spent: 0, lastActivity: '2025-08-14' },
                    quality: { balance: 780, earned: 780, spent: 0, lastActivity: '2025-08-16' }
                },
                'central-chili-conventional': {
                    farming: { balance: 640, earned: 640, spent: 0, lastActivity: '2025-08-13' },
                    supply: { balance: 490, earned: 490, spent: 0, lastActivity: '2025-08-12' },
                    quality: { balance: 570, earned: 570, spent: 0, lastActivity: '2025-08-14' }
                },
                'eastern-allium-organic': {
                    farming: { balance: 720, earned: 720, spent: 0, lastActivity: '2025-08-14' },
                    supply: { balance: 540, earned: 540, spent: 0, lastActivity: '2025-08-13' },
                    quality: { balance: 630, earned: 630, spent: 0, lastActivity: '2025-08-15' }
                },
                'eastern-allium-conventional': {
                    farming: { balance: 480, earned: 480, spent: 0, lastActivity: '2025-08-11' },
                    supply: { balance: 360, earned: 360, spent: 0, lastActivity: '2025-08-10' },
                    quality: { balance: 420, earned: 420, spent: 0, lastActivity: '2025-08-12' }
                },
                'southern-turmeric-organic': {
                    farming: { balance: 810, earned: 810, spent: 0, lastActivity: '2025-08-15' },
                    supply: { balance: 610, earned: 610, spent: 0, lastActivity: '2025-08-14' },
                    quality: { balance: 710, earned: 710, spent: 0, lastActivity: '2025-08-16' }
                },
                'coconut-organic': {
                    farming: { balance: 950, earned: 950, spent: 0, lastActivity: '2025-08-16' },
                    supply: { balance: 730, earned: 730, spent: 0, lastActivity: '2025-08-15' },
                    quality: { balance: 840, earned: 840, spent: 0, lastActivity: '2025-08-16' }
                }
            },

            // VERI Token Opportunities by Company Type and Role
            veriOpportunities: {
                importer: {
                    compliance: [
                        { id: 'comp-audit-1', title: 'Complete Quarterly Compliance Audit', description: 'Review and validate all compliance documentation for Q3 imports', tokens: 350, difficulty: 'medium', deadline: '2025-08-20', category: 'audit', completed: false },
                        { id: 'comp-cert-1', title: 'Update EORI Certificate', description: 'Renew EORI registration before expiration', tokens: 150, difficulty: 'easy', deadline: '2025-08-18', category: 'certification', completed: false },
                        { id: 'comp-train-1', title: 'Customs Regulation Training', description: 'Complete updated customs training module', tokens: 200, difficulty: 'easy', deadline: '2025-08-25', category: 'training', completed: true }
                    ],
                    purchase: [
                        { id: 'purch-po-1', title: 'Process New PO Requirements', description: 'Create and validate 3 new purchase orders with updated compliance checks', tokens: 280, difficulty: 'medium', deadline: '2025-08-19', category: 'po-creation', completed: false },
                        { id: 'purch-vendor-1', title: 'Vendor Compliance Review', description: 'Audit vendor compliance documentation and certifications', tokens: 320, difficulty: 'hard', deadline: '2025-08-22', category: 'vendor-management', completed: false },
                        { id: 'purch-cost-1', title: 'Cost Analysis Report', description: 'Generate quarterly cost analysis with compliance impact', tokens: 180, difficulty: 'easy', deadline: '2025-08-24', category: 'reporting', completed: false }
                    ],
                    quality: [
                        { id: 'qual-test-1', title: 'Lab Results Validation', description: 'Review and approve pending lab test results for 3 shipments', tokens: 220, difficulty: 'medium', deadline: '2025-08-17', category: 'testing', completed: false },
                        { id: 'qual-spec-1', title: 'Update Product Specifications', description: 'Revise product specs based on new quality standards', tokens: 260, difficulty: 'medium', deadline: '2025-08-21', category: 'specifications', completed: false }
                    ],
                    operations: [
                        { id: 'ops-dash-1', title: 'Weekly Operations Review', description: 'Conduct comprehensive review of all operational metrics', tokens: 300, difficulty: 'medium', deadline: '2025-08-18', category: 'review', completed: false },
                        { id: 'ops-risk-1', title: 'Risk Assessment Update', description: 'Update risk matrix for all active suppliers', tokens: 400, difficulty: 'hard', deadline: '2025-08-23', category: 'risk-management', completed: false }
                    ]
                },
                processor: {
                    export: [
                        { id: 'exp-ship-1', title: 'Export Documentation Review', description: 'Validate export documents for 5 pending shipments', tokens: 250, difficulty: 'medium', deadline: '2025-08-19', category: 'documentation', completed: false },
                        { id: 'exp-cert-1', title: 'Certificate of Origin Processing', description: 'Process and approve 8 certificates of origin', tokens: 180, difficulty: 'easy', deadline: '2025-08-20', category: 'certification', completed: false },
                        { id: 'exp-track-1', title: 'Shipment Tracking Update', description: 'Update tracking systems for all in-transit shipments', tokens: 120, difficulty: 'easy', deadline: '2025-08-17', category: 'tracking', completed: true }
                    ],
                    production: [
                        { id: 'prod-sched-1', title: 'Production Schedule Optimization', description: 'Optimize production schedule to meet export deadlines', tokens: 280, difficulty: 'medium', deadline: '2025-08-21', category: 'scheduling', completed: false },
                        { id: 'prod-qual-1', title: 'Quality Control Process Review', description: 'Review and improve quality control processes', tokens: 320, difficulty: 'hard', deadline: '2025-08-25', category: 'quality-control', completed: false }
                    ],
                    qa: [
                        { id: 'qa-cert-1', title: 'ISO Certification Renewal', description: 'Complete ISO certification renewal process', tokens: 400, difficulty: 'hard', deadline: '2025-08-30', category: 'certification', completed: false },
                        { id: 'qa-test-1', title: 'Raw Material Testing', description: 'Complete testing for all incoming raw materials', tokens: 200, difficulty: 'medium', deadline: '2025-08-18', category: 'testing', completed: false }
                    ],
                    compliance: [
                        { id: 'comp-reg-1', title: 'Regulatory Compliance Check', description: 'Verify compliance with updated export regulations', tokens: 350, difficulty: 'medium', deadline: '2025-08-22', category: 'regulatory', completed: false },
                        { id: 'comp-audit-2', title: 'Internal Audit Completion', description: 'Complete monthly internal compliance audit', tokens: 300, difficulty: 'medium', deadline: '2025-08-24', category: 'audit', completed: false }
                    ]
                },
                cooperative: {
                    farming: [
                        { id: 'farm-cert-1', title: 'Organic Certification Maintenance', description: 'Complete annual organic certification requirements', tokens: 300, difficulty: 'medium', deadline: '2025-08-26', category: 'certification', completed: false },
                        { id: 'farm-yield-1', title: 'Harvest Yield Documentation', description: 'Document and report harvest yields for all plots', tokens: 150, difficulty: 'easy', deadline: '2025-08-19', category: 'documentation', completed: false },
                        { id: 'farm-sustain-1', title: 'Sustainability Report', description: 'Complete quarterly sustainability impact report', tokens: 220, difficulty: 'medium', deadline: '2025-08-28', category: 'sustainability', completed: false }
                    ],
                    supply: [
                        { id: 'supply-coord-1', title: 'Delivery Coordination', description: 'Coordinate deliveries for 6 processor contracts', tokens: 180, difficulty: 'easy', deadline: '2025-08-20', category: 'logistics', completed: false },
                        { id: 'supply-contract-1', title: 'Contract Negotiations', description: 'Negotiate terms for 2 new processor contracts', tokens: 280, difficulty: 'medium', deadline: '2025-08-25', category: 'contracts', completed: false }
                    ],
                    quality: [
                        { id: 'qual-inspect-1', title: 'Quality Inspections', description: 'Complete quality inspections for all farmer lots', tokens: 200, difficulty: 'medium', deadline: '2025-08-21', category: 'inspection', completed: false },
                        { id: 'qual-trace-1', title: 'Traceability Updates', description: 'Update traceability records for all products', tokens: 160, difficulty: 'easy', deadline: '2025-08-23', category: 'traceability', completed: true }
                    ]
                }
            },

            // Companies Data
            companies: {
                'eu-gourmet': { 
                    id: 'eu-gourmet', 
                    name: 'EU Gourmet Imports B.V.', 
                    type: 'importer', 
                    country: 'Netherlands', 
                    city: 'Amsterdam'
                },
                'thai-chili-sauce': { 
                    id: 'thai-chili-sauce', 
                    name: 'Bangkok Chili Sauce Co. Ltd.', 
                    type: 'processor', 
                    country: 'Thailand', 
                    city: 'Bangkok'
                },
                'thai-curry-paste': { 
                    id: 'thai-curry-paste', 
                    name: 'Royal Curry Paste Industries', 
                    type: 'processor', 
                    country: 'Thailand', 
                    city: 'Chiang Mai'
                },
                'thai-coconut-milk': { 
                    id: 'thai-coconut-milk', 
                    name: 'Tropical Coconut Products Ltd.', 
                    type: 'processor', 
                    country: 'Thailand', 
                    city: 'Surat Thani'
                },
                'northern-herbs-organic': {
                    id: 'northern-herbs-organic',
                    name: 'Northern Thai Organic Herb Cooperative',
                    type: 'cooperative',
                    country: 'Thailand',
                    city: 'Chiang Rai'
                },
                'northern-herbs-conventional': {
                    id: 'northern-herbs-conventional',
                    name: 'Northern Thai Herb Farmers Association',
                    type: 'cooperative',
                    country: 'Thailand',
                    city: 'Chiang Mai'
                },
                'central-chili-organic': {
                    id: 'central-chili-organic',
                    name: 'Central Thai Organic Chili Cooperative',
                    type: 'cooperative',
                    country: 'Thailand',
                    city: 'Lopburi'
                },
                'central-chili-conventional': {
                    id: 'central-chili-conventional',
                    name: 'Central Thai Chili Farmers Union',
                    type: 'cooperative',
                    country: 'Thailand',
                    city: 'Saraburi'
                },
                'eastern-allium-organic': {
                    id: 'eastern-allium-organic',
                    name: 'Eastern Thai Organic Allium Cooperative',
                    type: 'cooperative',
                    country: 'Thailand',
                    city: 'Chonburi'
                },
                'eastern-allium-conventional': {
                    id: 'eastern-allium-conventional',
                    name: 'Eastern Thai Allium Growers Association',
                    type: 'cooperative',
                    country: 'Thailand',
                    city: 'Rayong'
                },
                'southern-turmeric-organic': {
                    id: 'southern-turmeric-organic',
                    name: 'Southern Thai Organic Turmeric Cooperative',
                    type: 'cooperative',
                    country: 'Thailand',
                    city: 'Nakhon Si Thammarat'
                },
                'coconut-organic': {
                    id: 'coconut-organic',
                    name: 'Premium Organic Coconut Cooperative',
                    type: 'cooperative',
                    country: 'Thailand',
                    city: 'Surat Thani'
                }
            },

            // Role-Specific KPI Data
            roleKPIs: {
                importer: {
                    purchase: {
                        'Active POs': { value: 3, unit: 'count', trend: '+1', color: 'primary' },
                        'Total Spend': { value: 905, unit: 'k EUR', trend: '+15%', color: 'info' },
                        'Delivery Performance': { value: 87, unit: '%', trend: '-3%', color: 'warning' },
                        'Supplier Performance': { value: 94, unit: '%', trend: '+2%', color: 'success' }
                    },
                    compliance: {
                        'Compliance Rate': { value: 94, unit: '%', trend: '+5%', color: 'success' },
                        'Documents Expiring': { value: 2, unit: 'count', trend: '+1', color: 'warning' },
                        'Audit Findings': { value: 1, unit: 'open', trend: '-2', color: 'danger' },
                        'Risk Score': { value: 'Medium', unit: '', trend: 'stable', color: 'warning' }
                    },
                    quality: {
                        'Test Results Pending': { value: 3, unit: 'tests', trend: '+1', color: 'warning' },
                        'Rejected Batches': { value: 0, unit: 'count', trend: '0', color: 'success' },
                        'Lab Turnaround': { value: 4.2, unit: 'days avg', trend: '-0.5', color: 'success' },
                        'Artwork Approvals': { value: 2, unit: 'pending', trend: '+2', color: 'info' }
                    },
                    operations: {
                        'Total PO Value': { value: 905, unit: 'k EUR', trend: '+15%', color: 'primary' },
                        'Risk Indicators': { value: 3, unit: 'active', trend: '+1', color: 'warning' },
                        'Supplier Issues': { value: 1, unit: 'critical', trend: '0', color: 'danger' },
                        'Performance Score': { value: 92, unit: '%', trend: '+3%', color: 'success' }
                    }
                },
                processor: {
                    export: {
                        'POs Received Value': { value: 635, unit: 'k EUR', trend: '+12%', color: 'primary' },
                        'Work in Process': { value: 285, unit: 'k EUR', trend: '+5%', color: 'info' },
                        'On-time Delivery': { value: 89, unit: '%', trend: '+4%', color: 'success' },
                        'Response Time': { value: 2.1, unit: 'days avg', trend: '-0.3', color: 'success' }
                    },
                    production: {
                        'Capacity Utilization': { value: 78, unit: '%', trend: '+8%', color: 'success' },
                        'Production Backlog': { value: 12, unit: 'days', trend: '+2', color: 'warning' },
                        'Raw Material Delivery': { value: 94, unit: '% on-time', trend: '+1%', color: 'success' },
                        'Equipment Efficiency': { value: 92, unit: '%', trend: '+2%', color: 'success' }
                    },
                    qa: {
                        'Raw Materials Approved': { value: 96, unit: '%', trend: '+2%', color: 'success' },
                        'Finished Goods Passed': { value: 98, unit: '%', trend: '+1%', color: 'success' },
                        'Certifications Renewing': { value: 3, unit: 'count', trend: '+1', color: 'warning' },
                        'Label Implementations': { value: 5, unit: 'pending', trend: '+2', color: 'info' }
                    },
                    compliance: {
                        'Compliance Rating': { value: 96, unit: '%', trend: '+1%', color: 'success' },
                        'Lost Sales (Non-Compliance)': { value: 15, unit: 'k EUR', trend: '-5k', color: 'success' },
                        'Recalled Goods Value': { value: 0, unit: 'EUR', trend: '0', color: 'success' },
                        'Audit Score': { value: 'A-', unit: '', trend: 'stable', color: 'success' }
                    }
                },
                cooperative: {
                    farming: {
                        'Harvest Yield': { value: 95, unit: '% target', trend: '+8%', color: 'success' },
                        'Quality Grade A': { value: 87, unit: '%', trend: '+5%', color: 'success' },
                        'Orders Fulfilled': { value: 12, unit: 'this month', trend: '+3', color: 'primary' },
                        'Certification Status': { value: 'Valid', unit: '', trend: 'stable', color: 'success' }
                    },
                    supply: {
                        'Active Contracts': { value: 8, unit: 'processors', trend: '+2', color: 'primary' },
                        'Monthly Revenue': { value: 45, unit: 'k EUR', trend: '+18%', color: 'success' },
                        'Delivery Timeliness': { value: 93, unit: '%', trend: '+4%', color: 'success' },
                        'Farmer Participation': { value: 124, unit: 'families', trend: '+6', color: 'info' }
                    },
                    quality: {
                        'Organic Compliance': { value: 98, unit: '%', trend: 'stable', color: 'success' },
                        'Test Results Passed': { value: 23, unit: 'of 24', trend: '+1', color: 'success' },
                        'Traceability Score': { value: 'A+', unit: '', trend: 'stable', color: 'success' },
                        'Sustainability Rating': { value: 4.8, unit: '/5.0', trend: '+0.2', color: 'success' }
                    }
                }
            }
        };
        
        // Role System
        window.VeriPuraRoles = {
            rolesByCompanyType: {
                importer: [
                    { id: 'compliance', name: 'Compliance Manager', icon: 'fas fa-shield-alt', level: 'manager' },
                    { id: 'purchase', name: 'Purchase Manager', icon: 'fas fa-shopping-cart', level: 'manager' },
                    { id: 'quality', name: 'Quality Manager', icon: 'fas fa-check-circle', level: 'manager' },
                    { id: 'operations', name: 'Operations Director', icon: 'fas fa-cogs', level: 'director' }
                ],
                processor: [
                    { id: 'export', name: 'Export Manager', icon: 'fas fa-shipping-fast', level: 'manager' },
                    { id: 'production', name: 'Production Manager', icon: 'fas fa-industry', level: 'manager' },
                    { id: 'qa', name: 'Quality Assurance', icon: 'fas fa-microscope', level: 'manager' },
                    { id: 'compliance', name: 'Compliance Director', icon: 'fas fa-shield-alt', level: 'manager' }
                ],
                cooperative: [
                    { id: 'farming', name: 'Farm Manager', icon: 'fas fa-seedling', level: 'manager' },
                    { id: 'supply', name: 'Supply Coordinator', icon: 'fas fa-truck', level: 'coordinator' },
                    { id: 'quality', name: 'Quality Inspector', icon: 'fas fa-search', level: 'inspector' }
                ]
            }
        };
        
        // Permission System
        window.VeriPuraPermissions = {
            documentAccess: {
                'compliance': {
                    'commercial-invoice': { view: true, edit: false },
                    'packing-list': { view: true, edit: false },
                    'certificate-of-origin': { view: true, edit: false },
                    'insurance-certificate': { view: true, edit: false }
                },
                'purchase': {
                    'commercial-invoice': { view: true, edit: true },
                    'packing-list': { view: true, edit: false },
                    'certificate-of-origin': { view: true, edit: false },
                    'insurance-certificate': { view: true, edit: true }
                },
                'quality': {
                    'commercial-invoice': { view: true, edit: false },
                    'packing-list': { view: true, edit: false },
                    'certificate-of-origin': { view: true, edit: false },
                    'insurance-certificate': { view: true, edit: false }
                },
                'operations': {
                    'commercial-invoice': { view: true, edit: true },
                    'packing-list': { view: true, edit: true },
                    'certificate-of-origin': { view: true, edit: true },
                    'insurance-certificate': { view: true, edit: true }
                },
                'export': {
                    'commercial-invoice': { view: true, edit: true },
                    'packing-list': { view: true, edit: true },
                    'certificate-of-origin': { view: true, edit: true },
                    'insurance-certificate': { view: true, edit: false }
                },
                'production': {
                    'commercial-invoice': { view: true, edit: false },
                    'packing-list': { view: true, edit: true },
                    'certificate-of-origin': { view: true, edit: false },
                    'insurance-certificate': { view: false, edit: false }
                },
                'qa': {
                    'commercial-invoice': { view: true, edit: false },
                    'packing-list': { view: true, edit: false },
                    'certificate-of-origin': { view: true, edit: true },
                    'insurance-certificate': { view: true, edit: false }
                },
                'farming': {
                    'commercial-invoice': { view: false, edit: false },
                    'packing-list': { view: false, edit: false },
                    'certificate-of-origin': { view: true, edit: false },
                    'insurance-certificate': { view: false, edit: false }
                },
                'supply': {
                    'commercial-invoice': { view: false, edit: false },
                    'packing-list': { view: true, edit: false },
                    'certificate-of-origin': { view: true, edit: false },
                    'insurance-certificate': { view: false, edit: false }
                }
            }
        };
        
        // Main Application Object
        window.VeriPura = {
            currentUser: null,
            currentCompany: null,
            currentRole: null,
            currentRoleId: null,
            
            // Utility Functions
            utils: {
                formatDate: function(date) {
                    if (!date) return '';
                    return new Date(date).toLocaleDateString('en-US', { 
                        year: 'numeric', 
                        month: 'long', 
                        day: 'numeric' 
                    });
                }
            },
            
            // Authentication System
            auth: {
                login: function(companyId, roleName) {
                    const company = VeriPuraData.companies[companyId];
                    if (company) {
                        const companyRoles = VeriPuraRoles.rolesByCompanyType[company.type];
                        const roleObj = companyRoles.find(r => r.name === roleName);
                        
                        VeriPura.currentUser = `${roleName} - ${company.name}`;
                        VeriPura.currentCompany = companyId;
                        VeriPura.currentRole = roleName;
                        VeriPura.currentRoleId = roleObj ? roleObj.id : null;
                        
                        document.getElementById('currentUser').textContent = roleName;
                        document.getElementById('loginScreen').classList.add('hide');
                        document.getElementById('mainApp').classList.remove('hide');
                        
                        VeriPura.dashboard.load();
                        
                        return true;
                    }
                    return false;
                },
                
                logout: function() {
                    VeriPura.currentUser = null;
                    VeriPura.currentCompany = null;
                    VeriPura.currentRole = null;
                    VeriPura.currentRoleId = null;
                    
                    document.getElementById('mainApp').classList.add('hide');
                    document.getElementById('loginScreen').classList.remove('hide');
                    document.getElementById('loginForm').reset();
                },
                
                switchRole: function() {
                    this.logout();
                }
            },
            
            // Dashboard System
            dashboard: {
                load: function() {
                    const container = document.getElementById('dashboardContainer');
                    if (!VeriPura.currentRoleId) {
                        container.innerHTML = '<div class="alert alert-danger">Session error. Please log in again.</div>';
                        return;
                    }
                    
                    container.innerHTML = this.createRoleDashboard();
                },

                // VERI Token Widget Functions
                createVeriTokenWidget: function() {
                    const tokenData = this.getVeriTokens();
                    if (!tokenData) return '';

                    return `
                        <div class="veri-token-widget" onclick="VeriPura.dashboard.showVeriTokenDetails()">
                            <div class="veri-token-icon">✓</div>
                            <div class="veri-token-info">
                                <p class="veri-token-balance">${tokenData.balance.toLocaleString()}</p>
                                <p class="veri-token-label">VERI Tokens</p>
                            </div>
                        </div>
                    `;
                },

                getVeriTokens: function() {
                    if (!VeriPura.currentCompany || !VeriPura.currentRoleId) return null;
                    
                    const companyTokens = VeriPuraData.veriTokens[VeriPura.currentCompany];
                    if (!companyTokens || !companyTokens[VeriPura.currentRoleId]) return null;
                    
                    return companyTokens[VeriPura.currentRoleId];
                },

                showVeriTokenDetails: function() {
                    const tokenData = this.getVeriTokens();
                    if (!tokenData) return;

                    VeriPura.notifications.show('info', 'VERI Token Details', 
                        `Balance: ${tokenData.balance} | Earned: ${tokenData.earned} | Last Activity: ${VeriPura.utils.formatDate(tokenData.lastActivity)}`
                    );
                },
                
                createRoleDashboard: function() {
                    const companyType = VeriPuraData.companies[VeriPura.currentCompany].type;
                    const roleId = VeriPura.currentRoleId;
                    const kpis = this.getKPIsForRole(roleId, companyType);
                    const hasCreatePOPermission = VeriPura.permissions.hasDocumentAccess('commercial-invoice', 'edit');
                    
                    return `
                        <div class="dashboard-header">
                            <div class="dashboard-title">
                                <h2>
                                    <i class="${this.getRoleIcon(roleId)}"></i> 
                                    ${VeriPura.currentRole} Dashboard
                                </h2>
                                <p class="text-muted">
                                    ${VeriPuraData.companies[VeriPura.currentCompany].name} | 
                                    <span class="company-badge company-${companyType}">${companyType}</span>
                                </p>
                            </div>
                            <div class="dashboard-actions">
                                ${this.createVeriTokenWidget()}
                                ${hasCreatePOPermission ? `
                                    <button class="btn btn-primary btn-lg me-2" onclick="VeriPura.notifications.show('info', 'PO Creation', 'PO creation system available in full version')">
                                        <i class="fas fa-plus-circle"></i> Send New PO
                                    </button>
                                ` : ''}
                                <button class="btn btn-outline-secondary" onclick="VeriPura.dashboard.load()">
                                    <i class="fas fa-sync-alt"></i> Refresh
                                </button>
                            </div>
                        </div>

                        ${this.generateKPISection(kpis)}
                        
                        <div class="content-grid">
                            <div class="section-card">
                                <div class="section-card-header">
                                    <i class="fas fa-file-alt"></i> Available Documents
                                </div>
                                <div class="section-card-body">
                                    ${this.generateDocumentTable()}
                                </div>
                            </div>
                            
                            <div class="opportunities-card">
                                <div class="opportunities-header">
                                    <div>
                                        <i class="fas fa-coins text-warning me-2"></i>
                                        <strong>VERI Token Opportunities</strong>
                                    </div>
                                    <div class="opportunities-filters">
                                        <button class="filter-btn active" onclick="VeriPura.opportunities.filterOpportunities('all')">All</button>
                                        <button class="filter-btn" onclick="VeriPura.opportunities.filterOpportunities('deadline')">Due Soon</button>
                                        <button class="filter-btn" onclick="VeriPura.opportunities.filterOpportunities('high-value')">High Value</button>
                                    </div>
                                </div>
                                <div id="opportunitiesContainer">
                                    ${VeriPura.opportunities.generateOpportunitiesSection()}
                                </div>
                            </div>
                        </div>
                    `;
                },

                getKPIsForRole: function(roleId, companyType) {
                    if (!VeriPuraData.roleKPIs[companyType] || !VeriPuraData.roleKPIs[companyType][roleId]) {
                        return { 'Status': { value: 'Active', unit: '', trend: '', color: 'success' } };
                    }
                    return VeriPuraData.roleKPIs[companyType][roleId];
                },

                generateKPISection: function(kpis) {
                    const kpiCards = Object.entries(kpis).map(([metricName, data]) => `
                        <div class="metric-card" onclick="VeriPura.dashboard.showKPIDetails('${metricName}')">
                            <div class="card-metric">
                                <h3 class="text-${data.color}">${data.value}</h3>
                                <p>${metricName}</p>
                                <small class="text-muted">${data.unit} ${data.trend}</small>
                            </div>
                        </div>
                    `).join('');

                    return `<div class="metrics-grid">${kpiCards}</div>`;
                },

                generateDocumentTable: function() {
                    const availableDocuments = [
                        { type: 'commercial-invoice', name: 'Commercial Invoice', category: 'Export' },
                        { type: 'packing-list', name: 'Packing List', category: 'Shipping' },
                        { type: 'certificate-of-origin', name: 'Certificate of Origin', category: 'Origin' },
                        { type: 'insurance-certificate', name: 'Insurance Certificate', category: 'Finance' }
                    ];
                    
                    const accessibleDocs = availableDocuments.filter(doc => 
                        VeriPura.permissions.hasDocumentAccess(doc.type, 'view')
                    );
                    
                    if (accessibleDocs.length === 0) {
                        return '<p class="text-muted text-center py-3">No documents accessible for your role</p>';
                    }
                    
                    return `
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Document Type</th>
                                    <th>Category</th>
                                    <th>Access</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${accessibleDocs.map(doc => {
                                    const canEdit = VeriPura.permissions.hasDocumentAccess(doc.type, 'edit');
                                    return `
                                        <tr>
                                            <td><strong>${doc.name}</strong></td>
                                            <td><span class="badge bg-light text-dark">${doc.category}</span></td>
                                            <td><span class="badge bg-${canEdit ? 'success' : 'info'}">${canEdit ? 'Edit' : 'View Only'}</span></td>
                                            <td>
                                                <button class="btn btn-sm btn-outline-primary" onclick="VeriPura.notifications.show('info', 'Document Viewer', 'Document templates available in full version')">
                                                    <i class="fas fa-eye"></i> View
                                                </button>
                                            </td>
                                        </tr>
                                    `;
                                }).join('')}
                            </tbody>
                        </table>
                    `;
                },

                getRoleIcon: function(roleId) {
                    const icons = {
                        'purchase': 'fas fa-shopping-cart',
                        'compliance': 'fas fa-shield-alt', 
                        'quality': 'fas fa-check-circle',
                        'operations': 'fas fa-cogs',
                        'export': 'fas fa-shipping-fast',
                        'production': 'fas fa-industry',
                        'qa': 'fas fa-microscope',
                        'farming': 'fas fa-seedling',
                        'supply': 'fas fa-truck'
                    };
                    return icons[roleId] || 'fas fa-user';
                },

                showKPIDetails: function(metricName) {
                    VeriPura.notifications.show('info', 'KPI Details', `Detailed analytics for ${metricName} available in full system.`);
                }
            },
            
            // VERI Token Opportunities System
            opportunities: {
                currentFilter: 'all',
                
                generateOpportunitiesSection: function() {
                    const opportunities = this.getOpportunitiesForRole();
                    if (!opportunities || opportunities.length === 0) {
                        return '<div class="text-center py-4 text-muted">No opportunities available for your role</div>';
                    }
                    
                    const filteredOpportunities = this.filterOpportunitiesByType(opportunities, this.currentFilter);
                    
                    return filteredOpportunities.map(opportunity => `
                        <div class="opportunity-item ${opportunity.completed ? 'task-completed' : ''}" data-id="${opportunity.id}">
                            <div class="opportunity-header">
                                <div>
                                    <div class="opportunity-title">${opportunity.title}</div>
                                    <div class="opportunity-description">${opportunity.description}</div>
                                </div>
                            </div>
                            <div class="opportunity-meta">
                                <span class="difficulty-badge difficulty-${opportunity.difficulty}">
                                    ${opportunity.difficulty.toUpperCase()}
                                </span>
                                <span class="token-reward">
                                    <i class="fas fa-coins"></i> ${opportunity.tokens}
                                </span>
                                <span class="deadline-badge">
                                    <i class="fas fa-calendar-alt"></i> ${VeriPura.utils.formatDate(opportunity.deadline)}
                                </span>
                                <span class="badge bg-light text-dark">${opportunity.category}</span>
                            </div>
                            ${!opportunity.completed ? `
                                <div class="opportunity-actions">
                                    <button class="complete-task-btn" onclick="VeriPura.opportunities.completeTask('${opportunity.id}')">
                                        <i class="fas fa-check"></i> Complete Task
                                    </button>
                                </div>
                            ` : `
                                <div class="opportunity-actions">
                                    <span class="badge bg-success">
                                        <i class="fas fa-check-circle"></i> Completed
                                    </span>
                                </div>
                            `}
                        </div>
                    `).join('');
                },
                
                getOpportunitiesForRole: function() {
                    if (!VeriPura.currentCompany || !VeriPura.currentRoleId) return [];
                    
                    const company = VeriPuraData.companies[VeriPura.currentCompany];
                    if (!company) return [];
                    
                    const companyOpportunities = VeriPuraData.veriOpportunities[company.type];
                    if (!companyOpportunities || !companyOpportunities[VeriPura.currentRoleId]) return [];
                    
                    return companyOpportunities[VeriPura.currentRoleId];
                },
                
                filterOpportunitiesByType: function(opportunities, filterType) {
                    const now = new Date();
                    const threeDaysFromNow = new Date(now.getTime() + (3 * 24 * 60 * 60 * 1000));
                    
                    switch(filterType) {
                        case 'deadline':
                            return opportunities.filter(opp => 
                                !opp.completed && new Date(opp.deadline) <= threeDaysFromNow
                            );
                        case 'high-value':
                            return opportunities.filter(opp => 
                                !opp.completed && opp.tokens >= 250
                            );
                        case 'all':
                        default:
                            return opportunities;
                    }
                },
                
                filterOpportunities: function(filter) {
                    this.currentFilter = filter;
                    
                    // Update filter button states
                    document.querySelectorAll('.filter-btn').forEach(btn => {
                        btn.classList.remove('active');
                    });
                    event.target.classList.add('active');
                    
                    // Refresh opportunities display
                    const container = document.getElementById('opportunitiesContainer');
                    if (container) {
                        container.innerHTML = this.generateOpportunitiesSection();
                    }
                },
                
                completeTask: function(taskId) {
                    const opportunities = this.getOpportunitiesForRole();
                    const task = opportunities.find(opp => opp.id === taskId);
                    
                    if (!task || task.completed) {
                        VeriPura.notifications.show('error', 'Task Error', 'Task not found or already completed');
                        return;
                    }
                    
                    // Mark task as completed
                    task.completed = true;
                    
                    // Update token balance
                    this.updateTokenBalance(task.tokens);
                    
                    // Show success notification
                    VeriPura.notifications.show('success', 'Task Completed!', 
                        `You earned ${task.tokens} VERI tokens for completing: ${task.title}`
                    );
                    
                    // Refresh displays
                    const container = document.getElementById('opportunitiesContainer');
                    if (container) {
                        container.innerHTML = this.generateOpportunitiesSection();
                    }
                    
                    // Update token widget
                    const tokenWidget = document.querySelector('.veri-token-widget');
                    if (tokenWidget) {
                        const newTokenData = VeriPura.dashboard.getVeriTokens();
                        if (newTokenData) {
                            const balanceElement = tokenWidget.querySelector('.veri-token-balance');
                            if (balanceElement) {
                                balanceElement.textContent = newTokenData.balance.toLocaleString();
                            }
                        }
                    }
                },
                
                updateTokenBalance: function(amount) {
                    if (!VeriPura.currentCompany || !VeriPura.currentRoleId) return;
                    
                    const companyTokens = VeriPuraData.veriTokens[VeriPura.currentCompany];
                    if (companyTokens && companyTokens[VeriPura.currentRoleId]) {
                        companyTokens[VeriPura.currentRoleId].balance += amount;
                        companyTokens[VeriPura.currentRoleId].earned += amount;
                        companyTokens[VeriPura.currentRoleId].lastActivity = new Date().toISOString().split('T')[0];
                    }
                }
            },
            
            // Permission System
            permissions: {
                hasDocumentAccess: function(documentType, action) {
                    if (!VeriPura.currentRoleId) return false;
                    const rolePermissions = VeriPuraPermissions.documentAccess[VeriPura.currentRoleId];
                    if (!rolePermissions || !rolePermissions[documentType]) return false;
                    return rolePermissions[documentType][action] === true;
                }
            },
            
            // Notification System
            notifications: {
                show: function(type, title, message) {
                    const toast = document.getElementById('notificationToast');
                    const toastTitle = document.getElementById('toastTitle');
                    const toastMessage = document.getElementById('toastMessage');
                    
                    toastTitle.textContent = title;
                    toastMessage.textContent = message;
                    
                    toast.className = `notification-toast ${type}`;
                    toast.style.borderLeft = type === 'success' ? '4px solid #0f766e' : 
                                          type === 'warning' ? '4px solid #d97706' : 
                                          type === 'error' ? '4px solid #dc2626' : '4px solid #0284c7';
                    toast.style.transform = 'translateX(0)';
                    
                    setTimeout(() => {
                        this.hide();
                    }, 5000);
                },
                
                hide: function() {
                    document.getElementById('notificationToast').style.transform = 'translateX(100%)';
                }
            }
        };
        
        // Login Form Handler
        document.addEventListener('DOMContentLoaded', function() {
            const loginForm = document.getElementById('loginForm');
            const companyTypeSelect = document.getElementById('companyTypeSelect');
            const companySelect = document.getElementById('companySelect');
            const roleSelect = document.getElementById('roleSelect');
            
            // Populate companies based on type
            companyTypeSelect.addEventListener('change', function() {
                const selectedType = this.value;
                companySelect.innerHTML = '<option value="">Select Organization...</option>';
                roleSelect.innerHTML = '<option value="">Select Role...</option>';
                
                if (selectedType) {
                    Object.values(VeriPuraData.companies)
                        .filter(company => company.type === selectedType)
                        .forEach(company => {
                            const option = document.createElement('option');
                            option.value = company.id;
                            option.textContent = company.name;
                            companySelect.appendChild(option);
                        });
                }
            });
            
            // Populate roles based on company
            companySelect.addEventListener('change', function() {
                const selectedCompanyId = this.value;
                roleSelect.innerHTML = '<option value="">Select Role...</option>';
                
                if (selectedCompanyId) {
                    const company = VeriPuraData.companies[selectedCompanyId];
                    const roles = VeriPuraRoles.rolesByCompanyType[company.type] || [];
                    
                    roles.forEach(role => {
                        const option = document.createElement('option');
                        option.value = role.name;
                        option.textContent = role.name;
                        roleSelect.appendChild(option);
                    });
                }
            });
            
            // Handle login
            loginForm.addEventListener('submit', function(e) {
                e.preventDefault();
                
                const companyId = companySelect.value;
                const roleName = roleSelect.value;
                
                if (companyId && roleName) {
                    VeriPura.auth.login(companyId, roleName);
                } else {
                    VeriPura.notifications.show('error', 'Login Error', 'Please select all required fields');
                }
            });
        });
    </script>
</body>
</html>